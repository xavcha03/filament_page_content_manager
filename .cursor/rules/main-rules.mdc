---
alwaysApply: true
---

# RÃ¨gles de dÃ©veloppement - Xavcha Page Content Manager

## ğŸ“‹ Contexte du projet

Ce projet est un **package Laravel Filament** pour gÃ©rer les pages avec un systÃ¨me de blocs de contenu flexible et rÃ©utilisable.

- **Namespace** : `Xavcha\PageContentManager`
- **Type** : Package Laravel (composer package)
- **Framework** : Laravel avec Filament
- **Environnement de dÃ©veloppement** : DDEV
- **Version actuelle** : Voir `composer.json` et `README.md` pour la version actuelle

## ğŸ§ª Tests - OBLIGATOIRE

**âš ï¸ RÃˆGLE CRITIQUE** : Toute nouvelle fonctionnalitÃ© ou modification DOIT Ãªtre accompagnÃ©e de tests.

### Structure des tests

- `tests/Unit/` : Tests unitaires pour les classes isolÃ©es (blocs, transformers, traits, etc.)
- `tests/Feature/` : Tests fonctionnels pour les intÃ©grations (API, modÃ¨les, service provider, etc.)
- `tests/Helpers/` : Helpers rÃ©utilisables pour les tests

### ExÃ©cution des tests

```bash
# Avec ddev (recommandÃ©)
ddev exec vendor/bin/phpunit

# Ou directement
composer test
```

### RÃ¨gles de test

1. **Toujours crÃ©er des tests** pour toute nouvelle fonctionnalitÃ©
2. **Tous les tests doivent passer** avant de commiter
3. **Utiliser `TestCase`** de `Xavcha\PageContentManager\Tests\TestCase` comme classe de base
4. **Nommer les tests** avec `test_` suivi d'une description claire : `test_can_get_block_by_type()`
5. **Tests unitaires** : Tester les classes isolÃ©ment, mocker les dÃ©pendances
6. **Tests fonctionnels** : Tester les intÃ©grations complÃ¨tes (API, modÃ¨les, etc.)

### Exemple de test

```php
<?php

namespace Xavcha\PageContentManager\Tests\Unit;

use Xavcha\PageContentManager\Tests\TestCase;

class MonNouveauBlocTest extends TestCase
{
    public function test_get_type_returns_correct_type(): void
    {
        $this->assertEquals('mon_bloc', MonNouveauBloc::getType());
    }

    public function test_transform_returns_correct_structure(): void
    {
        $data = ['titre' => 'Test'];
        $result = MonNouveauBloc::transform($data);
        
        $this->assertArrayHasKey('type', $result);
        $this->assertEquals('mon_bloc', $result['type']);
    }
}
```

## ğŸ“¦ Versionnement - OBLIGATOIRE

**âš ï¸ RÃˆGLE CRITIQUE** : Toute version publiÃ©e DOIT Ãªtre taguÃ©e dans Git.

### Convention de versionnement

Le package suit **Semantic Versioning** :
- **0.x.0** : Versions majeures (ajouts de fonctionnalitÃ©s, changements d'API)
- **0.0.x** : Versions mineures (nouvelles fonctionnalitÃ©s rÃ©trocompatibles)
- **0.0.0.x** : Versions patch (corrections de bugs)

### Processus de versionnement (OBLIGATOIRE)

1. **Mettre Ã  jour le CHANGELOG.md** :
   - Ajouter une nouvelle section `[X.Y.Z] - YYYY-MM-DD`
   - Documenter tous les changements (AjoutÃ©, ModifiÃ©, SupprimÃ©, SÃ©curitÃ©)
   - Suivre le format [Keep a Changelog](https://keepachangelog.com/fr/1.0.0/)

2. **Mettre Ã  jour la version dans `composer.json`** :
   ```json
   {
     "version": "0.2.4"
   }
   ```

3. **Mettre Ã  jour le README.md** :
   - Badge de version en haut du fichier
   - Section "Versions" avec la nouvelle version marquÃ©e comme actuelle

4. **CrÃ©er un commit** :
   ```bash
   git add CHANGELOG.md composer.json README.md
   git commit -m "Version 0.2.4 - Description des changements"
   ```

5. **CrÃ©er un tag Git annotÃ©** :
   ```bash
   git tag -a v0.2.4 -m "Version 0.2.4 - Description des changements"
   ```

6. **Pousser le commit et le tag** :
   ```bash
   git push origin main
   git push origin v0.2.4
   ```

## ğŸ“ Standards de code

### PHP

- **PSR-12** : Respecter les standards de codage PHP
- **Type hints** : Utiliser les types stricts (`declare(strict_types=1);`)
- **Return types** : Toujours spÃ©cifier les types de retour
- **Documentation** : Documenter les mÃ©thodes publiques avec PHPDoc
- **Nommage** : Utiliser des noms explicites et cohÃ©rents

### Structure des fichiers

- **Namespaces** : Respecter la structure `Xavcha\PageContentManager\{Component}`
- **Classes** : Un fichier = une classe
- **Tests** : MÃªme structure que `src/` mais dans `tests/`

### Conventions de nommage

- **Classes** : PascalCase (`BlockRegistry`, `ContentTab`)
- **MÃ©thodes** : camelCase (`getBlocks()`, `transform()`)
- **Variables** : camelCase (`$blockClass`, `$allBlocks`)
- **Constantes** : UPPER_SNAKE_CASE (`EXIT_CODE_SUCCESS`)
- **Tests** : `test_` suivi d'une description (`test_can_get_block()`)

## ğŸ”„ Workflow de dÃ©veloppement

### Processus standard

1. **CrÃ©er une branche** pour la fonctionnalitÃ©/correction :
   ```bash
   git checkout -b feature/nouvelle-fonctionnalite
   # ou
   git checkout -b fix/correction-bug
   ```

2. **DÃ©velopper et tester** :
   - Ã‰crire le code
   - **Ã‰crire les tests** (TDD recommandÃ©)
   - VÃ©rifier que tous les tests passent : `ddev exec vendor/bin/phpunit`

3. **Mettre Ã  jour la documentation** si nÃ©cessaire :
   - README.md (si fonctionnalitÃ© importante)
   - Documentation dans `docs/` (toujours)
   - Exemples d'utilisation

4. **Commit** avec un message clair :
   ```bash
   git commit -m "feat: Ajout de la fonctionnalitÃ© X"
   # ou
   git commit -m "fix: Correction du bug Y"
   ```

5. **Merge** dans `main` aprÃ¨s validation

### Ajout de nouvelles fonctionnalitÃ©s

Avant d'ajouter une nouvelle fonctionnalitÃ© :

1. âœ… VÃ©rifier qu'elle n'existe pas dÃ©jÃ  dans `docs/improvements.md`
2. âœ… S'assurer qu'elle est compatible avec l'architecture actuelle
3. âœ… **Ã‰crire les tests** avant ou pendant le dÃ©veloppement (TDD recommandÃ©)
4. âœ… Mettre Ã  jour la documentation (`docs/` et `README.md` si nÃ©cessaire)
5. âœ… Mettre Ã  jour le CHANGELOG lors de la version

### Modification de l'API

Si une modification casse la rÃ©trocompatibilitÃ© :

1. âš ï¸ **Augmenter le numÃ©ro de version majeure** (ex: 0.2.0 â†’ 0.3.0)
2. âš ï¸ **Documenter clairement** les breaking changes dans le CHANGELOG
3. âš ï¸ **Fournir un guide de migration** si nÃ©cessaire (dans `docs/`)

## ğŸ—ï¸ Architecture du projet

### Structure des dossiers

```
src/
â”œâ”€â”€ Blocks/              # SystÃ¨me de blocs
â”‚   â”œâ”€â”€ Core/           # Blocs core du package
â”‚   â”œâ”€â”€ Contracts/      # Interfaces (BlockInterface)
â”‚   â”œâ”€â”€ Concerns/       # Traits rÃ©utilisables
â”‚   â”œâ”€â”€ BlockRegistry.php
â”‚   â””â”€â”€ SectionTransformer.php
â”œâ”€â”€ Console/            # Commandes Artisan
â”œâ”€â”€ Facades/            # Facades (Blocks)
â”œâ”€â”€ Filament/           # Composants Filament
â”‚   â”œâ”€â”€ Forms/Components/
â”‚   â””â”€â”€ Resources/
â”œâ”€â”€ Http/               # ContrÃ´leurs API
â”œâ”€â”€ Models/             # ModÃ¨les Eloquent
â””â”€â”€ PageContentManagerServiceProvider.php
```

### SystÃ¨me de blocs

- **BlockInterface** : Tous les blocs doivent implÃ©menter cette interface
- **BlockRegistry** : Auto-dÃ©couverte des blocs dans `src/Blocks/Core/` et `app/Blocks/Custom/`
- **SectionTransformer** : Transformation des sections pour l'API
- **ContentTab** : Composant Filament rÃ©utilisable pour les blocs

Voir `docs/blocks-architecture.md` pour plus de dÃ©tails.

## ğŸ“š Documentation

### RÃ¨gles de documentation

1. **Toujours documenter** les nouvelles fonctionnalitÃ©s
2. **Mettre Ã  jour** `docs/improvements.md` quand une fonctionnalitÃ© est implÃ©mentÃ©e
3. **Mettre Ã  jour** `CHANGELOG.md` lors d'une nouvelle version
4. **README.md** : Pour les fonctionnalitÃ©s importantes et l'utilisation gÃ©nÃ©rale
5. **docs/** : Pour la documentation dÃ©taillÃ©e

### Fichiers de documentation

- `README.md` : Vue d'ensemble, installation, utilisation de base
- `CHANGELOG.md` : Historique des versions (format Keep a Changelog)
- `docs/improvements.md` : Roadmap et fonctionnalitÃ©s proposÃ©es
- `docs/blocks-architecture.md` : Architecture du systÃ¨me de blocs
- `docs/usage.md` : Guide d'utilisation dÃ©taillÃ©
- `docs/testing.md` : Guide des tests

**âš ï¸ IMPORTANT** : Pour les commandes CLI, les configurations, et autres dÃ©tails qui changent souvent, **rÃ©fÃ©rencer la documentation** plutÃ´t que de les dupliquer ici.

## ğŸ› ï¸ Environnement de dÃ©veloppement

### DDEV

Le package utilise **DDEV** pour l'environnement PHP :

```bash
# ExÃ©cuter les tests
ddev exec vendor/bin/phpunit

# Installer les dÃ©pendances
ddev composer install

# ExÃ©cuter les commandes Artisan (dans workbench/)
ddev exec "cd workbench && php artisan migrate"
```

### Workbench

Le package inclut un environnement de test complet dans `workbench/` :
- Application Laravel complÃ¨te pour tester visuellement
- Filament installÃ© pour tester l'interface
- Voir `docs/testing.md` pour plus de dÃ©tails

## âš ï¸ RÃ¨gles critiques Ã  respecter

1. **Tests obligatoires** : Toute fonctionnalitÃ© doit avoir des tests
2. **Versionnement obligatoire** : Toute version doit suivre le processus complet
3. **Documentation obligatoire** : Toute fonctionnalitÃ© doit Ãªtre documentÃ©e
4. **Tous les tests doivent passer** avant de commiter
5. **Respecter PSR-12** et les conventions de nommage
6. **RÃ©trocompatibilitÃ©** : Ã‰viter les breaking changes, ou augmenter la version majeure

## ğŸ“– RÃ©fÃ©rences rapides

Pour les dÃ©tails qui changent souvent, consulter :

- **Commandes CLI** : `README.md` section "CLI interactif pour la gestion des blocs"
- **Configuration** : `config/page-content-manager.php` et `README.md`
- **Architecture des blocs** : `docs/blocks-architecture.md`
- **Guide d'utilisation** : `docs/usage.md`
- **Tests** : `docs/testing.md`
- **AmÃ©liorations proposÃ©es** : `docs/improvements.md`

## ğŸ¯ Checklist avant commit

- [ ] Tous les tests passent (`ddev exec vendor/bin/phpunit`)
- [ ] Code respecte PSR-12
- [ ] Documentation mise Ã  jour si nÃ©cessaire
- [ ] Pas de breaking changes (ou version majeure si nÃ©cessaire)
- [ ] Message de commit clair et descriptif
